<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ROIDER 출석부</title>

<script src="./assets/fullcalendar/index.global.min.js"></script>

<style>
body{margin:0;font-family:Pretendard,system-ui;background:#0f1015;color:#e6e6e6}
header{height:72px;padding:0 24px;display:flex;align-items:center;justify-content:space-between;background:linear-gradient(180deg,#1b2431,#0f131b);border-bottom:1px solid #2a3242}
.logo{font-size:22px;font-weight:900;color:#ffc928;cursor:pointer}
.wrap{max-width:1200px;margin:0 auto;padding:20px}
.card{background:linear-gradient(180deg,#1b1f2b,#151924);border:1px solid #2a3242;border-radius:16px;padding:18px;margin-bottom:16px;box-shadow:0 10px 30px rgba(0,0,0,.3)}
.fc-daygrid-day-frame{position:relative}
.attend-btn{
  position:absolute;bottom:6px;left:50%;transform:translateX(-50%);
  padding:6px 10px;border-radius:10px;
  background:#ffc928;color:#000;font-weight:900;font-size:12px;
  cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.4);
  transition:.15s
}
.attend-btn:hover{transform:translateX(-50%) translateY(-1px)}
.attend-btn:active{transform:translateX(-50%) translateY(1px) scale(.96)}

.attend-past{background:#666;color:#ccc}

.modal-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.6);display:none;align-items:center;justify-content:center;z-index:999}
.modal{width:360px;background:#151924;border:1px solid #2a3242;border-radius:16px;padding:20px;position:relative}
.modal h3{margin:0 0 12px}
.modal input{width:100%;padding:10px;border-radius:10px;border:none;background:#0f1015;color:#fff;margin-bottom:10px}
.modal button{width:100%;padding:14px;border-radius:12px;border:none;background:linear-gradient(180deg,#ffd84d,#ffb700);font-weight:900;cursor:pointer}
.modal .close{position:absolute;top:10px;right:12px;font-size:20px;cursor:pointer}
</style>
</head>
<body>

<header>
  <div class="logo" onclick="location.href='main.html'">ROIDER</div>
</header>

<div class="wrap">
  <div class="card">
    <h2>출석 캘린더</h2>
    <div id="calendar"></div>
  </div>

  <div class="card">
    <h2>내 출석 기록</h2>
    <div id="myLog"></div>
  </div>
</div>

<div class="modal-backdrop" id="modalBg" onclick="closeModal(event)">
  <div class="modal">
    <div class="close" onclick="hideModal()">✕</div>
    <h3 id="modalDate"></h3>
    <input id="laby" type="number" placeholder="이계 점수">
    <input id="duel" type="number" placeholder="명결 점수">
    <button onclick="saveScore()">출석 저장</button>
  </div>
</div>

<script>
let selectedDate=null;
const storeKey="attendance_log";

function getLogs(){ return JSON.parse(localStorage.getItem(storeKey)||"{}"); }
function saveLogs(d){ localStorage.setItem(storeKey,JSON.stringify(d)); renderMyLog(); }

document.addEventListener("DOMContentLoaded",()=>{
  const cal = new FullCalendar.Calendar(document.getElementById("calendar"),{
    initialView:"dayGridMonth",
    locale:"ko",
    height:"auto",
    dayCellDidMount(info){
      const today = new Date().toISOString().slice(0,10);
      const dateStr = info.date.toISOString().slice(0,10);

      if(dateStr > today) return;

      const btn = document.createElement("div");
      btn.className="attend-btn";
      btn.innerText="출석";

      if(dateStr < today) btn.classList.add("attend-past");

      btn.onclick=()=>openModal(dateStr);
      info.el.querySelector(".fc-daygrid-day-frame").appendChild(btn);
    }
  });
  cal.render();
  renderMyLog();
});

function openModal(date){
  selectedDate=date;
  document.getElementById("modalDate").innerText=date;
  document.getElementById("modalBg").style.display="flex";
}
function hideModal(){document.getElementById("modalBg").style.display="none";}
function closeModal(e){if(e.target.id==="modalBg") hideModal();}

function saveScore(){
  let laby=+document.getElementById("laby").value||0;
  let duel=+document.getElementById("duel").value||0;
  const today=new Date().toISOString().slice(0,10);

  if(selectedDate<today){ laby=Math.floor(laby*0.5); duel=Math.floor(duel*0.5); }

  const logs=getLogs();
  logs[selectedDate]={laby,duel};
  saveLogs(logs);
  hideModal();
}

function renderMyLog(){
  const logs=getLogs();
  const el=document.getElementById("myLog");
  el.innerHTML="";
  Object.entries(logs).forEach(([d,v])=>{
    const div=document.createElement("div");
    div.innerText=`${d} - 이계:${v.laby}, 명결:${v.duel}`;
    el.appendChild(div);
  });
}
</script>
</body>
</html>