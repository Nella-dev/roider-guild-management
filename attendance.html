<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ROIDER ì¶œì„ë¶€</title>

<link rel="stylesheet" href="./assets/fullcalendar/fullcalendar.min.css">
<script src="./assets/fullcalendar/fullcalendar.min.js"></script>

<style>
body{margin:0;font-family:Pretendard,system-ui;background:#0f1015;color:#e6e6e6}
header{
  height:72px;padding:0 24px;display:flex;align-items:center;justify-content:space-between;
  background:linear-gradient(180deg,#1b2431,#0f131b);border-bottom:1px solid #2a3242
}
.logo{font-size:22px;font-weight:900;color:#ffc928;cursor:pointer}
.wrap{max-width:1200px;margin:0 auto;padding:20px}
.card{
  background:linear-gradient(180deg,#1b1f2b,#151924);
  border:1px solid #2a3242;border-radius:16px;padding:18px;margin-bottom:16px
}

/* ì¶œì„ ë²„íŠ¼ */
.attend-btn{
  margin-top:10px;
  width:100%;
  padding:10px 0;
  font-size:14px;
  font-weight:900;
  border-radius:10px;
  border:2px solid #ffc928;
  background:linear-gradient(180deg,#ffd84d,#ffb700);
  color:#000;
  cursor:pointer;
  transition:.1s;
}
.attend-btn:hover{filter:brightness(1.05)}
.attend-btn:active{transform:translateY(2px) scale(.97);filter:brightness(.9)}
.attended{background:#2a3242!important;border-color:#555!important;color:#aaa!important;cursor:default!important}
.past{background:#555!important;border-color:#999!important;color:#111!important}

/* ëª¨ë‹¬ */
.modal-backdrop{
  position:fixed;inset:0;background:rgba(0,0,0,.75);
  display:none;align-items:center;justify-content:center;z-index:999
}
.modal{
  width:380px;background:#151924;border:1px solid #2a3242;border-radius:18px;
  padding:22px;position:relative;box-shadow:0 20px 50px rgba(0,0,0,.6)
}
.modal h3{margin:0 0 14px;font-size:20px}
.modal input{
  width:100%;padding:12px;border-radius:10px;border:none;background:#0f1015;
  color:#fff;margin-bottom:12px;font-size:14px
}
.modal button{
  width:100%;padding:14px;border-radius:12px;border:none;
  background:linear-gradient(180deg,#ffd84d,#ffb700);font-weight:900;
  cursor:pointer;font-size:16px
}
.modal button:active{transform:translateY(2px) scale(.97)}
.modal-close{
  position:absolute;right:14px;top:10px;font-size:20px;cursor:pointer;opacity:.6
}
.modal-close:hover{opacity:1}
</style>
</head>
<body>

<header>
  <div class="logo" onclick="location.href='main.html'">ROIDER</div>
</header>

<div class="wrap">
  <div class="card">
    <h2>ì¶œì„ ìº˜ë¦°ë”</h2>
    <div id="calendar"></div>
  </div>
  <div class="card">
    <h2>ë‚´ ì¶œì„ ê¸°ë¡</h2>
    <div id="myLog">ì•„ì§ ì¶œì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>
  </div>
</div>

<div class="modal-backdrop" id="modal" onclick="if(event.target.id==='modal')closeModal()">
  <div class="modal">
    <div class="modal-close" onclick="closeModal()">âœ•</div>
    <h3 id="modalDate"></h3>
    <input id="laby" type="number" placeholder="ì´ê³„ ì ìˆ˜">
    <input id="duel" type="number" placeholder="ëª…ê²° ì ìˆ˜">
    <button onclick="saveScore()">ì¶œì„ ì €ì¥</button>
  </div>
</div>

<script>
let selectedDate=null;
const storageKey="roider_attendance";
const todayStr=new Date().toISOString().slice(0,10);

function loadData(){return JSON.parse(localStorage.getItem(storageKey)||"{}")}
function saveData(d){localStorage.setItem(storageKey,JSON.stringify(d))}
function closeModal(){document.getElementById("modal").style.display="none"}

document.addEventListener("DOMContentLoaded",()=>{
  const data=loadData();
  const cal=new FullCalendar.Calendar(document.getElementById("calendar"),{
    initialView:"dayGridMonth",locale:"ko",height:"auto",
    dayCellContent(arg){
      const d=arg.date.toISOString().slice(0,10);
      const isFuture=d>todayStr;
      const isPast=d<todayStr;
      const attended=data[d];

      const wrap=document.createElement("div");
      wrap.innerText=arg.dayNumberText;

      if(!isFuture){
        const btn=document.createElement("button");
        btn.className="attend-btn"+(attended?" attended":"")+(isPast&&!attended?" past":"");
        btn.innerText=attended?"ì™„ë£Œ":"ì¶œì„";
        if(!attended){
          btn.onclick=()=>openModal(d,isPast);
        }
        wrap.appendChild(btn);
      }
      return{domNodes:[wrap]};
    }
  });
  cal.render();
  renderLog();
});

function openModal(d,isPast){
  selectedDate={date:d,isPast};
  document.getElementById("modalDate").innerText=d+(isPast?" (ê³¼ê±° ì¶œì„ - 50% íŒ¨ë„í‹°)":"");
  document.getElementById("modal").style.display="flex";
}

function saveScore(){
  const laby=Number(document.getElementById("laby").value||0);
  const duel=Number(document.getElementById("duel").value||0);
  const final={
    laby:selectedDate.isPast?Math.floor(laby*0.5):laby,
    duel:selectedDate.isPast?Math.floor(duel*0.5):duel,
    raw:{laby,duel},
    time:new Date().toISOString()
  };
  const data=loadData();
  data[selectedDate.date]=final;
  saveData(data);
  location.reload();
}

function renderLog(){
  const data=loadData();
  const el=document.getElementById("myLog");
  const arr=Object.entries(data).sort((a,b)=>b[0].localeCompare(a[0]));
  el.innerHTML=arr.length?arr.map(([d,v])=>`
    <div>ğŸ“… ${d} | ì´ê³„ ${v.laby}, ëª…ê²° ${v.duel} ${v.raw?`(ì›ë³¸ ${v.raw.laby}/${v.raw.duel})`:''}</div>
  `).join(""):"ì•„ì§ ì¶œì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.";
}
</script>
</body>
</html>