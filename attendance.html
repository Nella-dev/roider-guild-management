<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ROIDER ì¶œì„ë¶€</title>

<!-- FullCalendar (local) -->
<link rel="stylesheet" href="./assets/fullcalendar/fullcalendar.min.css">
<script src="./assets/fullcalendar/fullcalendar.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Pretendard, system-ui, sans-serif;
  background: #0f1015;
  color: #e6e6e6;
}

header {
  height: 72px;
  padding: 0 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: linear-gradient(180deg, #1b2431, #0f131b);
  border-bottom: 1px solid #2a3242;
}

.logo { font-size:22px;font-weight:900;color:#ffc928;cursor:pointer; }
.wrap { max-width:1200px;margin:0 auto;padding:20px; }
.card {
  background: linear-gradient(180deg, #1b1f2b, #151924);
  border: 1px solid #2a3242;
  border-radius: 16px;
  padding: 18px;
  margin-bottom: 16px;
}

#calendar { margin-top:12px; }

/* ì¶œì„ ë²„íŠ¼ */
.attend-btn {
  margin-top:6px;
  padding:8px;
  border-radius:10px;
  background: linear-gradient(180deg,#ffd84d,#ffb700);
  font-weight:900;
  text-align:center;
  cursor:pointer;
  box-shadow:0 4px 0 #c98b00;
}
.attend-btn:active { transform:translateY(3px); box-shadow:0 1px 0 #c98b00; }

.past-day { background:rgba(255,255,255,0.05); }

/* ëª¨ë‹¬ */
.modal-backdrop {
  position:fixed; inset:0;
  background:rgba(0,0,0,.7);
  display:none; align-items:center; justify-content:center;
}
.modal {
  width:420px;
  background:#141a26;
  border-radius:20px;
  padding:24px;
}
.modal-header {
  display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;
}
.modal input {
  width:100%;padding:14px;border-radius:12px;border:none;background:#0f1015;color:#fff;
}
.save-btn {
  margin-top:20px;
  width:100%;
  padding:16px;
  border-radius:14px;
  background:linear-gradient(180deg,#ffd84d,#ffb700);
  font-weight:900;
  cursor:pointer;
}
</style>
</head>
<body>

<header>
  <div class="logo" onclick="location.href='main.html'">ROIDER</div>
</header>

<div class="wrap">
  <div class="card">
    <h2>ì¶œì„ ìº˜ë¦°ë”</h2>
    <div id="calendar"></div>
  </div>

  <div class="card">
    <h2>ë‚´ ì¶œì„ ê¸°ë¡</h2>
    <div id="myLog"></div>
  </div>
</div>

<div class="modal-backdrop" id="modal" onclick="if(event.target.id==='modal')closeModal()">
  <div class="modal">
    <div class="modal-header">
      <h3 id="modalDate"></h3>
      <span onclick="closeModal()">âœ•</span>
    </div>
    <input id="laby" placeholder="ì´ê³„ ì ìˆ˜">
    <input id="duel" placeholder="ëª…ê²° ì ìˆ˜" style="margin-top:10px;">
    <button class="save-btn" onclick="saveScore()">ì¶œì„ ì €ì¥</button>
  </div>
</div>

<script>
let selectedDate=null;
let calendar;
let attendanceData=JSON.parse(localStorage.getItem("attendanceData")||"{}");

document.addEventListener("DOMContentLoaded",()=>{
  const calEl=document.getElementById("calendar");
  calendar=new FullCalendar.Calendar(calEl,{
    initialView:"dayGridMonth",
    locale:"ko",
    height:"auto",
    dayCellDidMount(info){
      const d=info.date.toISOString().slice(0,10);
      const today=new Date().toISOString().slice(0,10);

      if(d>today) return;

      const btn=document.createElement("div");
      btn.className="attend-btn";
      btn.innerText="ì¶œì„í•˜ê¸°";
      btn.onclick=()=>openModal(d);
      info.el.appendChild(btn);

      if(attendanceData[d]){
        calendar.addEvent({title:attendanceData[d].title,start:d,allDay:true});
      }

      if(d<today) info.el.classList.add("past-day");
    }
  });
  calendar.render();
  renderLog();
});

function openModal(d){
  selectedDate=d;
  document.getElementById("modalDate").innerText=d;
  document.getElementById("modal").style.display="flex";
}

function closeModal(){ document.getElementById("modal").style.display="none"; }

function saveScore(){
  const laby=Number(document.getElementById("laby").value||0);
  const duel=Number(document.getElementById("duel").value||0);
  const today=new Date().toISOString().slice(0,10);
  const past=selectedDate<today;
  const finalLaby=past?Math.floor(laby*0.5):laby;
  const finalDuel=past?Math.floor(duel*0.5):duel;

  const title=`ì´ê³„:${finalLaby} / ëª…ê²°:${finalDuel}`;
  attendanceData[selectedDate]={laby:finalLaby,duel:finalDuel,title};
  localStorage.setItem("attendanceData",JSON.stringify(attendanceData));

  calendar.addEvent({title,start:selectedDate,allDay:true});
  renderLog();
  closeModal();
}

function renderLog(){
  const el=document.getElementById("myLog");
  const arr=Object.entries(attendanceData).sort();
  if(!arr.length){ el.innerText="ì•„ì§ ì¶œì„ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤."; return; }
  el.innerHTML=arr.map(([d,v])=>`ğŸ“… ${d} â†’ ì´ê³„ ${v.laby}, ëª…ê²° ${v.duel}`).join("<br>");
}
</script>

</body>
</html>