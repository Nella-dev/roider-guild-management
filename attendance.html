<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>출석부 - ROIDER</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>

<!-- FullCalendar (로컬) -->
<link rel="stylesheet" href="./fullcalendar/index.global.min.css">
<script src="./fullcalendar/index.global.min.js"></script>

<style>
body{margin:0;font-family:Pretendard,system-ui;background:#0f1015;color:#e6e6e6}
header{padding:14px 20px;background:#121721;border-bottom:1px solid #2a3242;display:flex;justify-content:space-between;align-items:center}
.wrap{max-width:1200px;margin:0 auto;padding:20px}
.card{background:#1c1f2a;border:1px solid #2a3242;border-radius:14px;padding:18px;margin-bottom:18px}

/* 게임 버튼 */
.game-btn {
  position: relative;
  background: linear-gradient(180deg, #ffd84d, #ffb700);
  color: #111;
  border: none;
  border-radius: 12px;
  padding: 12px 18px;
  font-weight: 900;
  cursor: pointer;
  box-shadow: 0 6px 0 #b8860b, 0 8px 14px rgba(0,0,0,0.6);
  transition: transform .06s ease, box-shadow .06s ease, filter .06s ease;
}
.game-btn:hover{filter:brightness(1.08)}
.game-btn:active{
  transform: translateY(4px);
  box-shadow: 0 2px 0 #b8860b, 0 4px 8px rgba(0,0,0,0.7);
}

/* 모달 */
.modal-bg{position:fixed;inset:0;background:rgba(0,0,0,.7);display:none;align-items:center;justify-content:center;z-index:999}
.modal{background:#1c1f2a;border:1px solid #2a3242;border-radius:14px;padding:20px;width:320px}
.modal input{width:100%;padding:10px;border-radius:8px;border:none;margin-bottom:10px}
</style>
</head>
<body>

<header>
  <div>ROIDER</div>
  <button class="game-btn" onclick="logout()">Logout</button>
</header>

<div class="wrap">
  <div class="card" id="status">로그인 확인 중...</div>

  <div class="card">
    <h3>출석 캘린더</h3>
    <div id="calendar"></div>
  </div>

  <div class="card">
    <h3>내 출석 기록</h3>
    <div id="myHistory">아직 출석 기록이 없습니다.</div>
  </div>
</div>

<!-- 모달 -->
<div class="modal-bg" id="modalBg">
  <div class="modal">
    <h3 id="modalDate"></h3>
    <input id="laby" type="number" placeholder="이계 점수"/>
    <input id="duel" type="number" placeholder="명결 점수"/>
    <button class="game-btn" onclick="saveAttendance()">저장</button>
    <button class="game-btn" onclick="closeModal()" style="background:#444;color:#fff;box-shadow:none">취소</button>
  </div>
</div>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCbqEcGsdSDBZs8PjiI05YRNEGupLf3nSc",
  authDomain: "roider-guild-management.firebaseapp.com",
  projectId: "roider-guild-management",
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let currentUser = null;
let selectedDate = null;

auth.onAuthStateChanged(async user=>{
  if(!user){ location.href="login.html"; return; }
  currentUser = user;
  document.getElementById("status").innerText = "출석 등록 가능";
  initCalendar();
});

function initCalendar(){
  const calendarEl = document.getElementById('calendar');
  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    locale: 'ko',
    dateClick(info){
      selectedDate = info.dateStr;
      document.getElementById("modalDate").innerText = info.dateStr;
      document.getElementById("modalBg").style.display = "flex";
    }
  });
  calendar.render();
}

function closeModal(){
  document.getElementById("modalBg").style.display = "none";
}

async function saveAttendance(){
  const laby = Number(document.getElementById("laby").value || 0);
  const duel = Number(document.getElementById("duel").value || 0);

  await db.collection("attendance_logs")
    .doc(currentUser.uid)
    .collection("days")
    .doc(selectedDate)
    .set({ date: selectedDate, laby, duel });

  alert("저장 완료!");
  closeModal();
}

function logout(){
  auth.signOut().then(()=>location.href="login.html");
}
</script>

</body>
</html>