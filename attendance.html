<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ROIDER 출석부</title>

<script src="./assets/fullcalendar/index.global.min.js"></script>

<style>
body {
  margin: 0;
  font-family: Pretendard, system-ui, sans-serif;
  background: #0f1015;
  color: #e6e6e6;
}

header {
  height: 72px;
  padding: 0 24px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: linear-gradient(180deg, #1b2431, #0f131b);
  border-bottom: 1px solid #2a3242;
}

.logo { font-size: 22px; font-weight: 900; color: #ffc928; cursor: pointer; }

.logout {
  padding: 10px 18px;
  border-radius: 12px;
  background: linear-gradient(180deg, #ffd84d, #ffb700);
  border: none;
  font-weight: 900;
  cursor: pointer;
  box-shadow: 0 5px 0 #b88600;
}
.logout:active { transform: translateY(3px); box-shadow: 0 2px 0 #b88600; }

.wrap { max-width: 1200px; margin: 0 auto; padding: 20px; }

.card {
  background: linear-gradient(180deg, #1b1f2b, #151924);
  border: 1px solid #2a3242;
  border-radius: 16px;
  padding: 18px;
  margin-bottom: 16px;
  box-shadow: 0 10px 30px rgba(0,0,0,.3);
}

#calendar { margin-top: 10px; }

/* 모달 */
.modal-backdrop {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.65);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

.modal {
  width: 380px;
  background: linear-gradient(180deg, #1b2230, #121722);
  border: 1px solid #2f3b52;
  border-radius: 18px;
  padding: 22px 20px 24px;
  box-shadow: 0 25px 60px rgba(0,0,0,.65);
  position: relative;
  animation: popup .18s ease-out;
}

@keyframes popup {
  from { transform: translateY(20px) scale(.95); opacity: 0; }
  to { transform: translateY(0) scale(1); opacity: 1; }
}

.modal h3 {
  margin: 0 0 14px;
  font-size: 20px;
  font-weight: 900;
  text-align: center;
  color: #ffd84d;
}

.modal-close {
  position: absolute;
  right: 14px;
  top: 10px;
  font-size: 22px;
  cursor: pointer;
  opacity: .6;
}

.modal input {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  border: 1px solid #2a3550;
  background: #0f1015;
  color: #fff;
  margin-bottom: 10px;
}

.modal button {
  width: 100%;
  padding: 16px 0;
  border-radius: 14px;
  border: none;
  background: linear-gradient(180deg, #ffd84d, #ffb700);
  color: #000;
  font-size: 18px;
  font-weight: 900;
  cursor: pointer;
  box-shadow: 0 6px 0 #b88600;
}
.modal button:active { transform: translateY(4px); box-shadow: 0 2px 0 #b88600; }
</style>
</head>
<body>

<header>
  <div class="logo" onclick="location.href='main.html'">ROIDER</div>
  <button class="logout">Logout</button>
</header>

<div class="wrap">
  <div class="card">
    <h2>출석 캘린더</h2>
    <div id="calendar"></div>
  </div>

  <div class="card">
    <h2>내 출석 기록</h2>
    <div id="myLog">아직 출석 기록이 없습니다.</div>
  </div>
</div>

<div class="modal-backdrop" id="modal" onclick="if(event.target.id==='modal')closeModal()">
  <div class="modal">
    <div class="modal-close" onclick="closeModal()">✕</div>
    <h3 id="modalDate"></h3>
    <input id="laby" type="number" placeholder="이계의 미궁 점수">
    <input id="duel" type="number" placeholder="명예의 결투 점수">
    <button onclick="saveScore()">출석 저장</button>
  </div>
</div>

<script>
let selectedDate = null;
let calendar;
const today = new Date().toISOString().slice(0,10);
let saved = JSON.parse(localStorage.getItem("attendance") || "{}");

document.addEventListener("DOMContentLoaded", () => {
  if (!window.FullCalendar) {
    alert("FullCalendar 로드 실패");
    return;
  }

  calendar = new FullCalendar.Calendar(document.getElementById("calendar"), {
    initialView: "dayGridMonth",
    locale: "ko",
    dateClick(info) {
      if (info.dateStr > today) return;
      openModal(info.dateStr);
    },
    events: Object.keys(saved).map(d => makeEvent(d, saved[d]))
  });

  calendar.render();
  renderLog();
});

function openModal(dateStr) {
  selectedDate = dateStr;
  document.getElementById("modalDate").innerText = dateStr;
  document.getElementById("modal").style.display = "flex";
}

function closeModal() {
  document.getElementById("modal").style.display = "none";
}

function makeEvent(date, data) {
  const isPast = date < today;
  const laby = isPast ? Math.floor(data.laby * 0.5) : data.laby;
  const duel = isPast ? Math.floor(data.duel * 0.5) : data.duel;
  return {
    title: `이계:${laby} / 명결:${duel}`,
    start: date,
    allDay: true,
    backgroundColor: isPast ? "#666" : "#ffc928",
    borderColor: isPast ? "#666" : "#ffc928",
    textColor: isPast ? "#ccc" : "#000"
  };
}

function saveScore() {
  const laby = Number(labyInput.value);
  const duel = Number(duelInput.value);

  saved[selectedDate] = { laby, duel };
  localStorage.setItem("attendance", JSON.stringify(saved));

  calendar.addEvent(makeEvent(selectedDate, saved[selectedDate]));
  renderLog();
  closeModal();
}

function renderLog() {
  const log = document.getElementById("myLog");
  log.innerHTML = Object.keys(saved).length
    ? Object.entries(saved).map(([d,v])=>`${d} - 이계:${v.laby}, 명결:${v.duel}`).join("<br>")
    : "아직 출석 기록이 없습니다.";
}
</script>

</body>
</html>