<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ROIDER ê¸¸ë“œ - ê¸¸ë“œì› ëª©ë¡</title>
  <link rel="stylesheet" href="header_standard.css">
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <script src="firebase_config.js"></script>

  <style>
    body { margin: 0; background: radial-gradient(circle at top, #1b2333, #0f1015 60%); color: #e6e6e6; min-height: 100vh; }
    .wrap { max-width: 900px; margin: 40px auto; padding: 20px; }
    h2 { color: #f4c430; margin-top: 0; margin-bottom: 10px; font-weight: 800; }
    .desc { color: #aaa; margin-bottom: 30px; line-height: 1.5; font-size: 15px; font-weight: 500; }
    .member-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 16px; }
    .member-card { background: #1c1f2a; border: 1px solid #2a3242; border-radius: 12px; padding: 20px; display: flex; align-items: center; gap: 15px; transition: transform 0.2s; }
    .member-card:hover { transform: translateY(-3px); border-color: #444; }
    .profile-img { width: 50px; height: 50px; border-radius: 50%; background: #2a3242; display: flex; align-items: center; justify-content: center; font-size: 24px; font-weight: 800; color: #fff; flex-shrink: 0; }
    .info-box { display: flex; flex-direction: column; gap: 5px; overflow: hidden; }
    .nickname { font-size: 18px; font-weight: 800; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .count-box { font-size: 14.5px; color: #00e676; font-weight: 800; margin-bottom: 20px; }
  </style>
</head>
<body>

  <header>
    <div class="logo" id="appTitle" onclick="location.href='main.html'">ROIDER GUILD</div>
    <div class="user-box">
      <img id="userPhoto" src="https://via.placeholder.com/32" alt="profile" />
      <span id="userName">ë¡œë”©ì¤‘...</span>
      <span id="myRoleBadge" class="role-badge" style="display:none;"></span>
      <button id="langToggleBtn" class="logout" onclick="toggleLanguage()" style="color:#f4c430; border-color:#f4c430;">ğŸŒ EN</button>
      <button class="logout" onclick="logout()" data-i18n="btn_logout">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </header>
  
  <nav class="top-nav">
    <div class="nav-container">
      <a href="main.html" class="nav-link" data-i18n="menu_home">í™ˆ</a>
      <a href="notice.html" class="nav-link" data-i18n="menu_notice">ê³µì§€ì‚¬í•­</a>
      <a href="attendance.html" class="nav-link" data-i18n="menu_calendar">í™œë™ ìº˜ë¦°ë”</a>
      <a href="weekly.html" class="nav-link" data-i18n="menu_weekly">ì£¼ê°„ ê²°ì‚°</a>
      <a href="members.html" class="nav-link" data-i18n="menu_members">ê¸¸ë“œì› ëª©ë¡</a>
      <a href="admin.html" class="nav-link" id="navAdminMenu" style="display: none; color: #ff5252;" data-i18n="menu_admin">ê¶Œí•œ ê´€ë¦¬</a>
    </div>
  </nav>

  <div class="wrap">
    <h2 data-i18n="mem_title">ğŸ‘¥ ê¸¸ë“œì› ëª©ë¡</h2>
    <p class="desc" data-i18n="mem_desc">í˜„ì¬ ROIDER ê¸¸ë“œì— ì†Œì†ëœ ìë‘ìŠ¤ëŸ¬ìš´ ë©¤ë²„ë“¤ì…ë‹ˆë‹¤.</p>
    
    <div class="count-box" id="memberCount" data-i18n="msg_loading">ë¡œë”©ì¤‘...</div>

    <div id="memberList" class="member-grid"></div>
  </div>

  <script>
    auth.onAuthStateChanged(async (user) => {
      if (!user) return location.replace("login.html");
      const docSnap = await db.collection("users").doc(user.uid).get();
      if (docSnap.exists && docSnap.data().role !== "pending") {
        loadMembersRealtime();
      }
    });

    function loadMembersRealtime() {
      db.collection("users").where("role", "in", ["member", "manager", "admin"])
        .onSnapshot((snapshot) => {
          let members = [];
          snapshot.forEach((doc) => { members.push({ id: doc.id, ...doc.data() }); });

          const roleWeight = { "admin": 1, "manager": 2, "member": 3 };
          members.sort((a, b) => {
            if (roleWeight[a.role] !== roleWeight[b.role]) return roleWeight[a.role] - roleWeight[b.role];
            return (a.nickname || "").localeCompare(b.nickname || "");
          });
          renderMembers(members);
        });
    }

    function renderMembers(members) {
      const list = document.getElementById("memberList");
      const countBox = document.getElementById("memberCount");
      list.innerHTML = "";

      // ğŸ’¡ ë‹¤êµ­ì–´ ì‚¬ì „ì„ ì°¸ì¡°í•˜ì—¬ ì¸ì›ìˆ˜ í‘œê¸°
      countBox.textContent = i18n[currentLang]["mem_count"] + members.length;

      if (members.length === 0) {
        list.innerHTML = `<p style='color:#aaa;' data-i18n='mem_empty'>${i18n[currentLang]["mem_empty"]}</p>`;
        return;
      }

      members.forEach(m => {
        // ğŸ’¡ ì§ì±… ì´ë¦„ë„ ì‚¬ì „ì—ì„œ ë¶ˆëŸ¬ì˜´ (ì˜ˆ: role_admin -> ìµœê³  ê´€ë¦¬ì / Guild Master)
        const roleName = i18n[currentLang]["role_" + m.role] || m.role;
        const roleClass = `role-${m.role}`;
        const firstLetter = m.nickname ? m.nickname.charAt(0).toUpperCase() : "?";

        const div = document.createElement("div");
        div.className = "member-card";
        div.innerHTML = `
          <div class="profile-img">${firstLetter}</div>
          <div class="info-box">
            <span class="nickname">${m.nickname || 'Unknown'}</span>
            <span class="role-badge ${roleClass}">${roleName}</span>
          </div>
        `;
        list.appendChild(div);
      });
      applyLanguage(); // ë°ì´í„° ë Œë”ë§ ì™„ë£Œ í›„ ë²ˆì—­ í™•ì •
    }
  </script>
</body>
</html>