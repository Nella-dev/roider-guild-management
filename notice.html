<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AFK Journey: Homestead ROIDER Guild Management</title>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
  <style>
    body { margin:0; font-family:Pretendard, system-ui; background:#0f1015; color:#e6e6e6; }
    header { padding:14px 20px; background:#121721; display:flex; justify-content:space-between; align-items:center; }
    .logo { color:#f4c430; font-weight:900; }
    .container { max-width:1000px; margin:0 auto; padding:30px 20px; }
    h1 { color:#f4c430; }
    .card { background:#1c1f2a; border-radius:14px; padding:20px; margin-bottom:20px; border:1px solid #2a3242; }
    textarea { width:100%; min-height:80px; padding:10px; border-radius:8px; background:#121721; color:white; border:1px solid #444; }
    button { padding:8px 14px; border-radius:10px; border:none; background:#f4c430; color:#000; font-weight:bold; cursor:pointer; }
    .notice-item { padding:12px; border-bottom:1px solid #333; }
    .notice-header { display:flex; justify-content:space-between; font-size:13px; opacity:.7; }
    .delete-btn { background:#ff5252; color:white; font-size:12px; margin-left:10px; }
  </style>
</head>
<body>
<header>
  <div class="logo" id="appTitle">ROIDER</div>
  <div class="user-box">
    <img id="userPhoto" src="" alt="profile" />
    <span id="userName">Loading...</span>
    <button class="logout" onclick="logout()">Logout</button>
  </div>
</header>
<div class="container">
  <h1 id="pageTitle">ğŸ“¢ ê³µì§€ì‚¬í•­</h1>
  <div class="card" id="adminWrite" style="display:none;">
    <h3>âœï¸ ê³µì§€ ì‘ì„±</h3>
    <textarea id="noticeInput" placeholder="ê³µì§€ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
    <button onclick="addNotice()">ë“±ë¡</button>
  </div>
  <div class="card">
    <h3>ğŸ“Œ ê³µì§€ ëª©ë¡</h3>
    <div id="noticeList"></div>
  </div>
</div>
<script>
  const firebaseConfig = { apiKey: "AIzaSyCbqEcGsdSDBZs8PjiI05YRNEGupLf3nSc", authDomain: "roider-guild-management.firebaseapp.com", projectId: "roider-guild-management", storageBucket: "roider-guild-management.firebasestorage.app", messagingSenderId: "1012249034459", appId: "1:1012249034459:web:ec0f821f29170446af96fe", measurementId: "G-J7W4LFLHPP" };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();
  document.addEventListener("DOMContentLoaded", () => {
    const title = document.getElementById("appTitle");
    if (title) { title.style.cursor = "pointer"; title.onclick = () => location.href = "main.html"; }
  });
  let isAdmin = false;
  auth.onAuthStateChanged(async user => {
    if (!user) location.href = "login.html";
    const userPhoto = document.getElementById("userPhoto");
    const userName = document.getElementById("userName");
    if (user.photoURL) userPhoto.src = user.photoURL;
    const snap = await db.collection("users").doc(user.uid).get();
    if (snap.exists) {
      const data = snap.data();
      userName.innerText = data.nickname || user.displayName || user.email;
    }
    const roleSnap = await db.collection("roles").doc(user.uid).get();
    isAdmin = roleSnap.exists && roleSnap.data().role === "admin";
    if (isAdmin) document.getElementById("adminWrite").style.display = "block";
    loadNotices();
  });
  async function loadNotices() {
    const list = document.getElementById("noticeList");
    list.innerHTML = "";
    const snap = await db.collection("notices").orderBy("createdAt", "desc").get();
    snap.forEach(doc => {
      const d = doc.data();
      const div = document.createElement("div");
      div.className = "notice-item";
      div.innerHTML = `<div class="notice-header"><span>${new Date(d.createdAt.seconds*1000).toLocaleString()}</span>${isAdmin ? `<button class="delete-btn" onclick="deleteNotice('${doc.id}')">ì‚­ì œ</button>` : ""}</div><div>${d.text}</div>`;
      list.appendChild(div);
    });
  }
  async function addNotice() {
    const text = document.getElementById("noticeInput").value.trim();
    if (!text) return;
    await db.collection("notices").add({ text, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
    document.getElementById("noticeInput").value = "";
    loadNotices();
  }
  async function deleteNotice(id) {
    if (!confirm("ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
    await db.collection("notices").doc(id).delete();
    loadNotices();
  }
  function logout() { auth.signOut().then(()=>location.href="login.html"); }
</script>
</body></html>
