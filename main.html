<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AFK Journey: Homestead ROIDER Guild Management</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>

  <style>
    :root {
      --bg: #0f1015;
      --card: #1c1f2a;
      --accent: #f4c430;
      --text: #e6e6e6;
    }

    body {
      margin: 0;
      font-family: Pretendard, system-ui, sans-serif;
      background: radial-gradient(circle at top, #1b2333, #0f1015 60%);
      color: var(--text);
      min-height: 100vh;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 14px 20px;
      background: linear-gradient(135deg, #1f2933, #121721);
      border-bottom: 1px solid #2a3242;
    }

    .logo {
      font-weight: 900;
      letter-spacing: 0.5px;
      color: var(--accent);
      text-shadow: 0 0 10px rgba(244,196,48,0.3);
    }

    .user-box {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 14px;
      color: #ccc;
    }

    .user-box img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      border: 1px solid #444;
    }

    .container {
      max-width: 1100px;
      margin: 0 auto;
      padding: 40px 20px;
      text-align: center;
    }

    .hero {
      margin-top: 40px;
      margin-bottom: 30px;
    }

    .hero h1 {
      font-size: 2rem;
      margin-bottom: 12px;
      color: var(--accent);
    }

    .hero p {
      opacity: 0.8;
    }

    .menu-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 16px;
      margin-top: 40px;
    }

    .menu-card {
      background: linear-gradient(180deg, #1f2736, #161b26);
      border: 1px solid #2a3242;
      border-radius: 14px;
      padding: 24px 10px;
      cursor: pointer;
      transition: 0.25s;
      box-shadow: 0 6px 20px rgba(0,0,0,0.4);
    }

    .menu-card:hover {
      transform: translateY(-6px) scale(1.02);
      border-color: var(--accent);
      box-shadow: 0 10px 30px rgba(244,196,48,0.25);
    }

    .menu-card span {
      display: block;
      font-size: 28px;
      margin-bottom: 8px;
    }

    .footer {
      margin-top: 60px;
      text-align: center;
      font-size: 12px;
      opacity: 0.5;
    }

    button.logout {
      background: transparent;
      border: 1px solid #555;
      color: #ccc;
      border-radius: 20px;
      padding: 6px 14px;
      cursor: pointer;
    }

    button.logout:hover {
      border-color: var(--accent);
      color: var(--accent);
    }
  </style>
</head>
<body>

  <header>
    <div class="logo" id="appTitle">ROIDER</div>
    <div class="user-box">
      <img id="userPhoto" src="" alt="profile" />
      <span id="userName">Loading...</span>
      <button class="logout" onclick="logout()">Logout</button>
    </div>
  </header>

  <div class="container">
    <div class="hero">
      <h1 id="heroTitle">AFK Journey: Homestead ROIDER Guild Management</h1>
      <p id="heroDesc">Guild Operation & Weekly Management System</p>
    </div>

    <div class="menu-grid">
      <div class="menu-card" onclick="go('notice.html')">
        <span>üì¢</span> Í≥µÏßÄ
      </div>
      <div class="menu-card" onclick="go('members.html')">
        <span>üë•</span> Í∏∏ÎìúÏõê
      </div>
      <div class="menu-card" onclick="go('attendance.html')">
        <span>üìÖ</span> Ï∂úÏÑùÎ∂Ä
      </div>
      <div class="menu-card" onclick="go('weekly.html')">
        <span>üèÜ</span> Ï£ºÍ∞ÑÍ≤∞ÏÇ∞
      </div>
      <div class="menu-card" onclick="go('war.html')">
        <span>‚öîÔ∏è</span> ÎåÄÌï≠Ï†Ñ
      </div>
    </div>

    <div class="footer">
      AFK Journey Fanmade Tool ¬∑ ROIDER Guild
    </div>
  </div>

  <script>
  // Firebase ÏÑ§Ï†ï (ÎÑ§Í∞Ä Ï§Ä Í∞í)
  const firebaseConfig = {
    apiKey: "AIzaSyCbqEcGsdSDBZs8PjiI05YRNEGupLf3nSc",
    authDomain: "roider-guild-management.firebaseapp.com",
    projectId: "roider-guild-management",
    storageBucket: "roider-guild-management.firebasestorage.app",
    messagingSenderId: "1012249034459",
    appId: "1:1012249034459:web:ec0f821f29170446af96fe",
    measurementId: "G-J7W4LFLHPP"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // Íµ≠Í∞Ä Í∏∞Î∞ò Ïñ∏Ïñ¥ ÏûêÎèô ÏÑ§Ï†ï
  const userLang = navigator.language || navigator.userLanguage;
  const lang = userLang.startsWith("ko") ? "ko" : "en";

  const titleText = (lang === "ko")
    ? "AFK: ÏÉàÎ°úÏö¥ Ïó¨Ï†ï-ÌûêÎßÅÎÜçÏû• ROIDER Í∏∏Îìú Í¥ÄÎ¶¨ ÏãúÏä§ÌÖú"
    : "AFK Journey: Homestead ROIDER Guild Management";

  document.title = titleText;
  document.getElementById("appTitle").innerText = titleText;
  document.getElementById("heroTitle").innerText = titleText;

  // üîê Î°úÍ∑∏Ïù∏ + ÎãâÎÑ§ÏûÑ + ÏäπÏù∏ Ï≤¥ÌÅ¨
  auth.onAuthStateChanged(async (user) => {
    if (!user) {
      location.href = "login.html";
      return;
    }

    // ÏÇ¨Ïö©Ïûê Í∏∞Î≥∏ Ï†ïÎ≥¥ ÌëúÏãú
  // ‚úÖ Î°úÏª¨ ÎãâÎÑ§ÏûÑ Ïö∞ÏÑ† ÌëúÏãú
const localNickname = localStorage.getItem("nickname");
document.getElementById("userName").innerText =
  localNickname || user.displayName || user.email;

// ‚úÖ ÌîÑÎ°úÌïÑ Ïù¥ÎØ∏ÏßÄ Íπ®Ïßê Î∞©ÏßÄ (Í∏∞Î≥∏ Ïù¥ÎØ∏ÏßÄ fallback)
const photoEl = document.getElementById("userPhoto");
if (user.photoURL) {
  photoEl.src = user.photoURL;
} else {
  photoEl.src = "https://api.dicebear.com/7.x/bottts/svg?seed=roider";
}

    // Firestore Îì±Î°ù Ïó¨Î∂Ä ÌôïÏù∏
    const docRef = db.collection("registered_devices").doc(user.uid);
    const docSnap = await docRef.get();

    // ÎãâÎÑ§ÏûÑ Îì±Î°ù Ïïà ÎêêÏúºÎ©¥ ‚Üí ÎãâÎÑ§ÏûÑ Îì±Î°ù ÌéòÏù¥ÏßÄ
    if (!docSnap.exists) {
      location.href = "nickname.html";
      return;
    }

    const data = docSnap.data();

    // Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÎåÄÍ∏∞
    if (!data.approved) {
      alert(lang === "ko"
        ? "Í¥ÄÎ¶¨Ïûê ÏäπÏù∏ ÎåÄÍ∏∞ Ï§ëÏûÖÎãàÎã§."
        : "Waiting for admin approval."
      );
      location.href = "pending.html"; // ÏäπÏù∏ ÎåÄÍ∏∞ ÌéòÏù¥ÏßÄ (ÏóÜÏúºÎ©¥ ÎßåÎì§Ïñ¥Ï£ºÎ©¥ Îê®)
      return;
    }

    // ÏäπÏù∏ ÏôÑÎ£å ‚Üí Í∑∏ÎÉ• Î©îÏù∏ UI ÏÇ¨Ïö©
    console.log("ÏäπÏù∏ ÏôÑÎ£å, Î©îÏù∏ Ï†ëÍ∑º ÌóàÏö©");
  });

  function logout() {
    auth.signOut().then(() => location.href = "login.html");
  }

  function go(url) {
    location.href = url;
  }
</script>

</body>
</html>
