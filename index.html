<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ROIDER Guild Management</title>
<style>
:root {
  --bg:#0f1015;--card:#1c1f2a;--accent:#f4c430;--text:#e6e6e6;
}
body.light{--bg:#f4f6fb;--card:#fff;--accent:#ff9800;--text:#222;}
body{margin:0;font-family:Pretendard;background:var(--bg);color:var(--text);}
header{display:flex;justify-content:space-between;align-items:center;padding:14px 20px;background:linear-gradient(135deg,#1f2933,#121721);}
nav button{background:none;border:none;color:var(--text);font-weight:bold;margin-right:10px;cursor:pointer;}
nav button:hover{color:var(--accent);}
.card{background:var(--card);border-radius:12px;padding:16px;margin:16px;}
.hidden{display:none;}
input,button{padding:10px;border-radius:8px;border:none;}
button.primary{background:var(--accent);font-weight:bold;}
table{width:100%;border-collapse:collapse;}
th,td{padding:8px;border-bottom:1px solid #333;text-align:center;}
</style>
</head>
<body>

<header>
  <div><b>ROIDER Guild Management</b></div>
  <nav>
    <button onclick="show('notice')">ğŸ“¢ ê³µì§€</button>
    <button onclick="show('members')">ğŸ‘¥ ê¸¸ë“œì›</button>
    <button onclick="show('attendance')">ğŸ“… ì¶œì„ë¶€</button>
    <button onclick="show('weekly')">ğŸ† ì£¼ê°„ê²°ì‚°</button>
    <button onclick="show('war')">âš”ï¸ ëŒ€í•­ì „</button>
  </nav>
  <select onchange="setTheme(this.value)">
    <option value="system">ì‹œìŠ¤í…œ</option>
    <option value="dark">ë‹¤í¬</option>
    <option value="light">í™”ì´íŠ¸</option>
  </select>
</header>

<div id="notice" class="card">
  <h2>ğŸ“¢ ê³µì§€</h2>
  <textarea id="noticeInput" style="width:100%;height:80px;"></textarea>
  <button class="primary" onclick="saveNotice()">ì €ì¥</button>
  <div id="noticeList"></div>
</div>

<div id="members" class="card hidden">
  <h2>ğŸ‘¥ ê¸¸ë“œì›</h2>
  <input id="newMember" placeholder="ë‹‰ë„¤ì„">
  <button onclick="addMember()">ì¶”ê°€</button>
  <ul id="memberList"></ul>
</div>

<div id="attendance" class="card hidden">
  <h2>ğŸ“… ì¶œì„ë¶€</h2>
  <button class="primary" onclick="markAttendance('laby')">ì´ê³„ ì¶œì„</button>
  <button class="primary" onclick="markAttendance('duel')">ëª…ê²° ì¶œì„</button>
  <ul id="attendanceLog"></ul>
</div>

<div id="weekly" class="card hidden">
  <h2>ğŸ† ì£¼ê°„ê²°ì‚° (AFK v3.6 ë¶„ë¦¬ ë¶„ë°°)</h2>
  <input id="totalChest" type="number" placeholder="ì´ ìƒì ìˆ˜"><br><br>
  <input id="allocContrib" type="number" placeholder="ê³µí—Œ ë°°ì •">
  <input id="allocLaby" type="number" placeholder="ì´ê³„ ë°°ì •">
  <input id="allocDuel" type="number" placeholder="ëª…ê²° ë°°ì •"><br><br>

  <input id="rankContrib" type="number" value="5"> ê³µí—Œ Top N  
  <input id="rankLaby" type="number" value="5"> ì´ê³„ Top N  
  <input id="rankDuel" type="number" value="5"> ëª…ê²° Top N  
  <br><br>
  <button class="primary" onclick="calculate()">ë¶„ë°° ê³„ì‚°</button>
  <table id="weeklyTable"></table>
</div>

<div id="war" class="card hidden">
  <h2>âš”ï¸ ëŒ€í•­ì „</h2>
  <p>ì „ìˆ  UI ì˜ˆì •</p>
</div>

<script>
let state = JSON.parse(localStorage.getItem("roider")) || {
  isAdmin:true,
  members:[],
  attendance:[],
  notices:[]
};

function saveState(){localStorage.setItem("roider",JSON.stringify(state));}
function show(id){document.querySelectorAll('.card').forEach(c=>c.classList.add("hidden"));document.getElementById(id).classList.remove("hidden");}
function setTheme(m){m==="light"?document.body.classList.add("light"):document.body.classList.remove("light");}

function saveNotice(){state.notices.push(document.getElementById("noticeInput").value);document.getElementById("noticeInput").value="";saveState();render();}
function addMember(){const v=document.getElementById("newMember").value;if(!v)return;state.members.push({name:v,contrib:0,laby:0,duel:0});document.getElementById("newMember").value="";saveState();render();}

function markAttendance(type){
  const today=new Date().toLocaleDateString();
  state.attendance.push({type,date:today});
  state.members.forEach(m=>{
    if(type==="laby") m.laby+=10;
    if(type==="duel") m.duel+=10;
  });
  saveState();render();
}

function distribute(pool, list){
  const n=list.length;
  if(n===0||pool<=0) return [];
  let weights=[]; let sum=0;
  for(let i=0;i<n;i++){ let w=n+(n-i); weights.push(w); sum+=w; }
  let res=weights.map(w=>Math.floor(pool*(w/sum)));
  let diff=pool-res.reduce((a,b)=>a+b,0);
  let i=0; while(diff>0){res[i%n]++; diff--; i++;}
  return res;
}

function calculate(){
  if(!state.isAdmin) return alert("ê´€ë¦¬ìë§Œ ë¶„ë°° ê°€ëŠ¥");
  const aC=+allocContrib.value,aL=+allocLaby.value,aD=+allocDuel.value;
  const rC=+rankContrib.value,rL=+rankLaby.value,rD=+rankDuel.value;

  const cList=[...state.members].sort((a,b)=>b.contrib-a.contrib).slice(0,rC);
  const lList=[...state.members].sort((a,b)=>b.laby-a.laby).slice(0,rL);
  const dList=[...state.members].sort((a,b)=>b.duel-a.duel).slice(0,rD);

  const cRes=distribute(aC,cList);
  const lRes=distribute(aL,lList);
  const dRes=distribute(aD,dList);

  let html="<tr><th>êµ¬ë¶„</th><th>ìˆœìœ„</th><th>ë‹‰ë„¤ì„</th><th>ìƒì</th></tr>";
  cList.forEach((m,i)=>html+=`<tr><td>ê³µí—Œ</td><td>${i+1}</td><td>${m.name}</td><td>${cRes[i]}</td></tr>`);
  lList.forEach((m,i)=>html+=`<tr><td>ì´ê³„</td><td>${i+1}</td><td>${m.name}</td><td>${lRes[i]}</td></tr>`);
  dList.forEach((m,i)=>html+=`<tr><td>ëª…ê²°</td><td>${i+1}</td><td>${m.name}</td><td>${dRes[i]}</td></tr>`);

  weeklyTable.innerHTML=html;
}

function render(){
  noticeList.innerHTML=state.notices.map(n=>`<p>${n}</p>`).join("");
  memberList.innerHTML=state.members.map(m=>`<li>${m.name} (ê³µí—Œ:${m.contrib} / ì´ê³„:${m.laby} / ëª…ê²°:${m.duel})</li>`).join("");
  attendanceLog.innerHTML=state.attendance.map(a=>`<li>${a.date} - ${a.type}</li>`).join("");
}
render();
</script>
</body>
</html>
